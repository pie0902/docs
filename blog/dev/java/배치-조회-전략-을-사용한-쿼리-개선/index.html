<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">배치 조회 전략 을 사용한 쿼리 개선 | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pie0902.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://pie0902.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://pie0902.github.io/docs/blog/dev/java/배치-조회-전략-을-사용한-쿼리-개선"><meta data-rh="true" property="og:locale" content="ko"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="배치 조회 전략 을 사용한 쿼리 개선 | My Site"><meta data-rh="true" name="description" content="관리자 페이지에서 상품마다 생긴 주문 상세를 조회 할 때 N+1 문제가 발생 했다."><meta data-rh="true" property="og:description" content="관리자 페이지에서 상품마다 생긴 주문 상세를 조회 할 때 N+1 문제가 발생 했다."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-04-25T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/pie0902"><meta data-rh="true" property="article:tag" content="Dev,Java/SpringBoot,Java"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pie0902.github.io/docs/blog/dev/java/배치-조회-전략-을-사용한-쿼리-개선"><link data-rh="true" rel="alternate" href="https://pie0902.github.io/docs/blog/dev/java/배치-조회-전략-을-사용한-쿼리-개선" hreflang="ko"><link data-rh="true" rel="alternate" href="https://pie0902.github.io/docs/blog/dev/java/배치-조회-전략-을-사용한-쿼리-개선" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://pie0902.github.io/docs/blog/dev/java/배치-조회-전략-을-사용한-쿼리-개선","mainEntityOfPage":"https://pie0902.github.io/docs/blog/dev/java/배치-조회-전략-을-사용한-쿼리-개선","url":"https://pie0902.github.io/docs/blog/dev/java/배치-조회-전략-을-사용한-쿼리-개선","headline":"배치 조회 전략 을 사용한 쿼리 개선","name":"배치 조회 전략 을 사용한 쿼리 개선","description":"관리자 페이지에서 상품마다 생긴 주문 상세를 조회 할 때 N+1 문제가 발생 했다.","datePublished":"2024-04-25T00:00:00.000Z","author":{"@type":"Person","name":"thunder","description":"개발자","url":"https://github.com/pie0902"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://pie0902.github.io/docs/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/docs/assets/css/styles.45b1dd04.css">
<script src="/docs/assets/js/runtime~main.a6ca4a5c.js" defer="defer"></script>
<script src="/docs/assets/js/main.1d90056c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/logo.svg"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="메인" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="사이드바 펼치거나 접기" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/docs/blog/categories">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Categories</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/blog/tags/til">TIL</a></li><li><a class="dropdown__link" href="/docs/blog/tags/dev">Dev</a></li><li><a class="dropdown__link" href="/docs/blog/tags/dev/java-springboot">Java/SpringBoot</a></li><li><a class="dropdown__link" href="/docs/blog/tags/cs">CS</a></li><li><a class="dropdown__link" href="/docs/blog/tags/project">Project</a></li><li><a class="dropdown__link" href="/docs/blog/tags/infra">Infra</a></li><li><a class="dropdown__link" href="/docs/blog/tags/embedded">Embedded</a></li><li><a class="dropdown__link" href="/docs/blog/tags/writing">Writing</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/pie0902" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_xvU1 postTitle_nF1Z">배치 조회 전략 을 사용한 쿼리 개선</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-04-25T00:00:00.000Z">2024년 4월 25일</time> · <!-- -->약 6분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/docs/blog/authors/thunder"><span class="authorName_yefp" translate="no">thunder</span></a></div><small class="authorTitle_nd0D" title="개발자">개발자</small><div class="authorSocials_rSDt"><a href="https://github.com/pie0902" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><blockquote>
<p>관리자 페이지에서 상품마다 생긴 주문 상세를 조회 할 때 N+1 문제가 발생 했다.<br>
<!-- -->상품을 불러오고 주문서를 불러오고 주문 상세를 불러올 때마다 데이터베이스에서 관련 데이터들을 계속 조회 하면서 데이터를 가져온다.</p>
</blockquote>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="productservice-에서-관리자의-상품-조회-코드">productService 에서 관리자의 상품 조회 코드<a href="#productservice-에서-관리자의-상품-조회-코드" class="hash-link" aria-label="productService 에서 관리자의 상품 조회 코드에 대한 직접 링크" title="productService 에서 관리자의 상품 조회 코드에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="productadmindto">productAdminDto<a href="#productadmindto" class="hash-link" aria-label="productAdminDto에 대한 직접 링크" title="productAdminDto에 대한 직접 링크" translate="no">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Getter  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductAdminResponse {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long id;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String name;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long price;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long stock;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;OrderDetailAdminResponse&gt; orderDetails;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ProductAdminResponse(Product product,List&lt;OrderDetailAdminResponse&gt; orderDetails) {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.id = product.getId();  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.name = product.getName();  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.price = product.getPrice();  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.stock = product.getStock();  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.orderDetails = orderDetails;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="관리자-페이지에서-상품들을-조회하는-메서드">관리자 페이지에서 상품들을 조회하는 메서드<a href="#관리자-페이지에서-상품들을-조회하는-메서드" class="hash-link" aria-label="관리자 페이지에서 상품들을 조회하는 메서드에 대한 직접 링크" title="관리자 페이지에서 상품들을 조회하는 메서드에 대한 직접 링크" translate="no">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public List&lt;ProductAdminResponse&gt; getAdminProducts(User user, Pageable pageable) {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Page&lt;Product&gt; productPage = productRepository.findAllByUserIdAndStateTrue(user.getId(),  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pageable);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return getPageResponse2(productPage);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="상품마다-주문한-주문상세를-표시하는-메서드">상품마다 주문한 주문상세를 표시하는 메서드<a href="#상품마다-주문한-주문상세를-표시하는-메서드" class="hash-link" aria-label="상품마다 주문한 주문상세를 표시하는 메서드에 대한 직접 링크" title="상품마다 주문한 주문상세를 표시하는 메서드에 대한 직접 링크" translate="no">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//상품을 주문한 사람들의 상세주문서 조회  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private List&lt;ProductAdminResponse&gt; getPageResponse2(Page&lt;Product&gt; productPage) {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return productPage.getContent().stream()  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .map(product -&gt; {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;OrderDetail&gt; orderDetails = orderAdminService.findOrderDetailsByProductId(  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                product.getId());  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;OrderDetailAdminResponse&gt; orderDetailResponseDtos = new ArrayList&lt;&gt;();  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (OrderDetail orderDetail : orderDetails) {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Order order = orderRepository.getById(orderDetail.getOrderId());  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                orderDetailResponseDtos.add(new OrderDetailAdminResponse(orderDetail, order));  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new ProductAdminResponse(product, orderDetailResponseDtos);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .collect(Collectors.toList());  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="코드의-구조">코드의 구조<a href="#코드의-구조" class="hash-link" aria-label="코드의 구조에 대한 직접 링크" title="코드의 구조에 대한 직접 링크" translate="no">​</a></h3>
<ol>
<li class="">productPage.getContent()<!-- -->:page<!-- --> 객체에서 product 객체의 리스트를 추출한다.</li>
</ol>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">return productPage.getContent().stream() .map(product -&gt; {</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">그 상품에 해당되는 주문 상세정보를 리스트로 가져온다.</li>
</ol>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;OrderDetail&gt; orderDetails = orderAdminService.findOrderDetailsByProductId(product.getId());</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">조회된 주문 상세정보 리스트를 순회하며 각 주문의 상세정보들을 가져온다.</li>
</ol>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;OrderDetailAdminResponse&gt; orderDetailResponseDtos = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (OrderDetail orderDetail : orderDetails) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Order order = orderRepository.getById(orderDetail.getOrderId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderDetailResponseDtos.add(new OrderDetailAdminResponse(orderDetail, order));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="문제점">문제점<a href="#문제점" class="hash-link" aria-label="문제점에 대한 직접 링크" title="문제점에 대한 직접 링크" translate="no">​</a></h3>
<ol>
<li class="">
<p>데이터가 한 두 개면 크게 문제없지만, 상품 수가 200개, 1000개처럼 많아지면 처리해야 할 데이터베이스 조회량이 엄청나게 늘어나서, 시스템 전체의 성능이 많이 떨어질 수 있다.</p>
</li>
<li class="">
<p>각 상품에 대해 주문 상세 정보를 가져오고, 각 주문 상세 정보마다 주문 정보를 다시 조회해야 해서 매 상품마다 발생하는 추가적인 데이터베이스 호출이 많아져서 처리 속도가 현저히 떨어진다.</p>
</li>
<li class="">
<p>여러 데이터베이스 호출이 필요한데, 각 호출이 의존성을 갖고 순차적으로 이뤄져야 하므로, 하나의 호출에서 지연이 발생하면 전체 응답 시간이 길어질 수 있다. 이러한 연쇄적인 지연은 사용자 경험을 저하시킬 수 있다.</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="해결-방법">해결 방법<a href="#해결-방법" class="hash-link" aria-label="해결 방법에 대한 직접 링크" title="해결 방법에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="id-리스트-기반의-배치-조회-최적화">ID 리스트 기반의 배치 조회 최적화<a href="#id-리스트-기반의-배치-조회-최적화" class="hash-link" aria-label="ID 리스트 기반의 배치 조회 최적화에 대한 직접 링크" title="ID 리스트 기반의 배치 조회 최적화에 대한 직접 링크" translate="no">​</a></h4>
<ul>
<li class="">ID 리스트 기반의 배치(batch) 조회 최적화: OrderDetail과 Order를 각각의 ID 리스트를 기반으로 한 배치 조회로 처리하면, 데이터베이스 호출 횟수를 크게 줄일 수 있다. 이는 OrderDetail을 조회한 후, 이들에서 파생된 Order ID들로 Order를 한 번에 조회하는 방식으로 진행될 수 있다.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="코드-수정">코드 수정<a href="#코드-수정" class="hash-link" aria-label="코드 수정에 대한 직접 링크" title="코드 수정에 대한 직접 링크" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="orderdataservice-class-생성">orderDataService Class 생성<a href="#orderdataservice-class-생성" class="hash-link" aria-label="orderDataService Class 생성에 대한 직접 링크" title="orderDataService Class 생성에 대한 직접 링크" translate="no">​</a></h4>
<ul>
<li class="">
<p>우리팀의 서버는 msa 방식으로 운영되기 때문에 다른 도메인에서 필요한 메서드들을 feign을 이용해서 주입받아야 한다.</p>
</li>
<li class="">
<p>orderService에서 productService를 주입받고 있기 때문에 순환참조를 방지하고 의존성을 낮추기 위해 orderDataService class를 생성해서 필요한 메서드들을 작성한다.</p>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="개선된-코드">개선된 코드<a href="#개선된-코드" class="hash-link" aria-label="개선된 코드에 대한 직접 링크" title="개선된 코드에 대한 직접 링크" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="productservice">ProductService<a href="#productservice" class="hash-link" aria-label="ProductService에 대한 직접 링크" title="ProductService에 대한 직접 링크" translate="no">​</a></h5>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private List&lt;ProductAdminResponse&gt; getAdminPageResponse(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Page&lt;Product&gt; productPage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">){  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Product List ID 리스트 추출  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Long&gt; productIds = productPage.getContent().stream().map(Product::getId).collect(Collectors.toList());  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;OrderDetail&gt; orderDetails = orderDataService.getOrderDetailListUseProductIdList(productIds);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // OrderDetail 배치 조회  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Long&gt; orderIds = orderDataService.getOrderIdList(orderDetails);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Order 배치 조회  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map&lt;Long,Order&gt; orderMap = orderDataService.getOrderMap(orderIds);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //productAdminResponse 생성  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map&lt;Long,List&lt;OrderDetailAdminResponse&gt;&gt; orderDetailsMap = orderDataService.getOrderDetailAdminResponse(orderMap,orderDetails);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return productPage.getContent().stream()  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .map(product -&gt; new ProductAdminResponse(product, orderDetailsMap.getOrDefault(product.getId(), Collections.emptyList())))  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .collect(Collectors.toList());  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="orderdataservice">OrderDataService<a href="#orderdataservice" class="hash-link" aria-label="OrderDataService에 대한 직접 링크" title="OrderDataService에 대한 직접 링크" translate="no">​</a></h5>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Service  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequiredArgsConstructor  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderDataService {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final OrderRepository orderRepository;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final OrderDetailRepository orderDetailRepository;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //**********************productService에서 필요한 메서드**************************//  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;OrderDetail&gt; getOrderDetailListUseProductIdList(List&lt;Long&gt; productIds){  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;OrderDetail&gt; orderDetails = orderDetailRepository.findByProductIdIn(productIds);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return orderDetails;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;Long&gt; getOrderIdList(List&lt;OrderDetail&gt; orderDetails){  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Long&gt; orderIds = orderDetails.stream()  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(OrderDetail::getOrderId)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .distinct()  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .collect(Collectors.toList());  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return orderIds;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map&lt;Long, Order&gt; getOrderMap(List&lt;Long&gt; orderIds) {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Order&gt; orders = orderRepository.findByIdIn(orderIds);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;Long,Order&gt; orderMap = orders.stream().collect(Collectors.toMap(Order::getId,order -&gt; order));  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return orderMap;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map&lt;Long, List&lt;OrderDetailAdminResponse&gt;&gt; getOrderDetailAdminResponse(Map&lt;Long,Order&gt; orderMap,List&lt;OrderDetail&gt; orderDetails) {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;Long, List&lt;OrderDetailAdminResponse&gt;&gt; orderDetailsMap = orderDetails.stream()  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .collect(Collectors.groupingBy(OrderDetail::getProductId,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Collectors.mapping(od -&gt; new OrderDetailAdminResponse(od, orderMap.get(od.getOrderId())), Collectors.toList())));  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return orderDetailsMap;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="orderrepositoryorderdetailrepository">OrderRepository&amp;OrderDetailRepository<a href="#orderrepositoryorderdetailrepository" class="hash-link" aria-label="OrderRepository&amp;OrderDetailRepository에 대한 직접 링크" title="OrderRepository&amp;OrderDetailRepository에 대한 직접 링크" translate="no">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//오더 아이디 리스트로 오더를 한번에 가져오는 쿼리  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Order&gt; findByIdIn(List&lt;Long&gt; orderIds);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//프로덕트 아이디들의 주문서들을 한번에 가져오는 쿼리  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;OrderDetail&gt; findByProductIdIn(List&lt;Long&gt; productIds);</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="개선되기-전-코드의-쿼리">개선되기 전 코드의 쿼리<a href="#개선되기-전-코드의-쿼리" class="hash-link" aria-label="개선되기 전 코드의 쿼리에 대한 직접 링크" title="개선되기 전 코드의 쿼리에 대한 직접 링크" translate="no">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.created_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.description,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.image_url,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.modified_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.state,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.stock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.user_id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        product p1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.user_id=? </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        and p1_0.state </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ?, ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.kakao_tid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.address_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.created_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.modified_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.state,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.user_id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orders o1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.kakao_tid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.address_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.created_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.modified_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.state,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.user_id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orders o1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id=?</span><br></span></code></pre></div></div>
<ol>
<li class="">
<p><strong>페이징 처리된 상품들을 조회</strong>: 데이터베이스에서 특정 조건(여기서는 <code>user_id</code>와 상품의 <code>state</code>)에 맞는 상품들을 페이징 처리하여 조회한다.</p>
</li>
<li class="">
<p><strong>상품 ID를 사용하여 모든</strong> <code>OrderDetail</code> 조회: 단계 1에서 조회된 각 상품 ID를 기반으로 해당 상품들과 관련된 모든 <code>OrderDetail</code>을 데이터베이스에서 조회한다. 이 과정은 각 상품에 대한 주문 상세 정보를 가져오기 위해 수행된다.</p>
</li>
<li class="">
<p><code>OrderDetail</code>에서 얻은 <code>Order</code> ID를 사용하여 모든 <code>Order</code> 조회: 조회된 <code>OrderDetail</code>들이 갖고 있는 <code>Order</code> ID를 사용하여 해당 주문들의 전체 정보를 데이터베이스에서 조회한다.</p>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="개선된-코드의-쿼리-수가-현저히-줄어든-것을-확인-할-수-있다">개선된 코드의 쿼리 (수가 현저히 줄어든 것을 확인 할 수 있다.)<a href="#개선된-코드의-쿼리-수가-현저히-줄어든-것을-확인-할-수-있다" class="hash-link" aria-label="개선된 코드의 쿼리 (수가 현저히 줄어든 것을 확인 할 수 있다.)에 대한 직접 링크" title="개선된 코드의 쿼리 (수가 현저히 줄어든 것을 확인 할 수 있다.)에 대한 직접 링크" translate="no">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.created_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.description,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.image_url,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.modified_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.state,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.stock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.user_id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        product p1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p1_0.user_id=? </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        and p1_0.state </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ?, ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.order_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.reviewed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order_detail od1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        od1_0.product_id in (?, ?, ?, ?, ?, ?, ?, ?)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hibernate: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* &lt;criteria&gt; */ select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.kakao_tid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.address_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.created_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.modified_at,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.state,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.user_id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orders o1_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o1_0.id in (?, ?)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class="">
<p><strong>페이징 처리된 상품들을 조회</strong>: 이 쿼리는 특정 사용자(<code>user_id</code>)가 소유하고 있는 활성 상태(<code>state</code>)의 상품들을 조회한다. 결과는 페이징 처리를 통해 제한된다. 이는 일반적으로 사용자의 상품 목록을 보여줄 때 사용된다.</p>
</li>
<li class="">
<p><strong>주문 상세 조회 쿼리</strong>: 이 쿼리는 특정 상품 ID들에 대한 모든 주문 상세 정보를 조회한다. <code>product_id</code> 필드를 기준으로 여러 상품에 대한 주문 상세를 한 번의 쿼리로 불러온다. 이는 상품 ID 리스트를 기반으로 해당 상품들이 포함된 주문들의 상세 정보를 가져올 때 사용된다.</p>
</li>
<li class="">
<p><strong>주문 조회 쿼리</strong>: 이 쿼리는 특정 주문 ID 리스트를 기반으로 해당 주문들의 상세 정보를 조회한다. 주문 상세 정보에서 얻은 <code>order_id</code>들을 사용하여 연관된 주문의 모든 정보를 한 번에 가져온다. 이는 주문 처리 시스템에서 특정 주문들에 대한 상세 정보를 보여줄 필요가 있을 때 사용된다.</p>
</li>
</ol></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="개발 실전 노트" class="tag_zVej tagRegular_sFm0" href="/docs/blog/tags/dev">Dev</a></li><li class="tag_QGVx"><a rel="tag" title="Java/Spring Boot 관련 글" class="tag_zVej tagRegular_sFm0" href="/docs/blog/tags/dev/java-springboot">Java/SpringBoot</a></li><li class="tag_QGVx"><a rel="tag" title="Java 관련 글" class="tag_zVej tagRegular_sFm0" href="/docs/blog/tags/dev/java">Java</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="블로그 게시물 탐색"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/blog/2024/04/25/til/til-목요일"><div class="pagination-nav__sublabel">이전 게시물</div><div class="pagination-nav__label">TIL: 2024-04-25 목요일</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/blog/2024/04/25/til/today-i-learned"><div class="pagination-nav__sublabel">다음 게시물</div><div class="pagination-nav__label">2024.04.25 Today I Learned</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#productservice-에서-관리자의-상품-조회-코드" class="table-of-contents__link toc-highlight">productService 에서 관리자의 상품 조회 코드</a></li><li><a href="#코드의-구조" class="table-of-contents__link toc-highlight">코드의 구조</a></li><li><a href="#문제점" class="table-of-contents__link toc-highlight">문제점</a></li><li><a href="#해결-방법" class="table-of-contents__link toc-highlight">해결 방법</a></li><li><a href="#코드-수정" class="table-of-contents__link toc-highlight">코드 수정</a></li></ul></div></div></div></div></div></div>
</body>
</html>