"use strict";(globalThis.webpackChunkmy_portfolio=globalThis.webpackChunkmy_portfolio||[]).push([[53167],{11472:e=>{e.exports=JSON.parse('{"permalink":"/docs/blog/til/\ub3d9\uc2dc\uc131-\uc81c\uc5b4\uc640-\uc2a4\ucf00\uc904\ub9c1\uc744-\ud1b5\ud55c-\ud6a8\uacfc\uc801\uc778-\uc8fc\ubb38-\ubc0f-\uc7ac\uace0-\uad00\ub9ac-\uc804\ub7b5","source":"@site/blog/til/\ub3d9\uc2dc\uc131-\uc81c\uc5b4\uc640-\uc2a4\ucf00\uc904\ub9c1\uc744-\ud1b5\ud55c-\ud6a8\uacfc\uc801\uc778-\uc8fc\ubb38-\ubc0f-\uc7ac\uace0-\uad00\ub9ac-\uc804\ub7b5.md","title":"\ub3d9\uc2dc\uc131 \uc81c\uc5b4\uc640 \uc2a4\ucf00\uc904\ub9c1\uc744 \ud1b5\ud55c \ud6a8\uacfc\uc801\uc778 \uc8fc\ubb38 \ubc0f \uc7ac\uace0 \uad00\ub9ac \uc804\ub7b5","description":"\ub3d9\uc2dc\uc131 \uc81c\uc5b4\ub97c \uc801\uc6a9\ud55c \ubd80\ubd84\uc5d0\uc11c \ubb38\uc81c\ub97c \ubc1c\uacac\ud588\ub2e4.","date":"2024-10-16T00:00:00.000Z","tags":[{"inline":false,"label":"TIL","permalink":"/docs/blog/tags/til","description":"\ud559\uc2b5\uae30\ub85d"},{"inline":false,"label":"HTTPS","permalink":"/docs/blog/tags/cs/network/https","description":"HTTPS/TLS"},{"inline":false,"label":"Java","permalink":"/docs/blog/tags/dev/java","description":"Java \uad00\ub828 \uae00"},{"inline":false,"label":"Network","permalink":"/docs/blog/tags/cs/network","description":"\ub124\ud2b8\uc6cc\ud06c"},{"inline":false,"label":"OS","permalink":"/docs/blog/tags/cs/os","description":"\uc6b4\uc601\uccb4\uc81c"},{"inline":false,"label":"Spring","permalink":"/docs/blog/tags/dev/spring","description":"Spring/Spring Boot"},{"inline":false,"label":"Testing","permalink":"/docs/blog/tags/dev/testing","description":"\ud14c\uc2a4\ud2b8/\ud14c\uc2a4\ud2b8\ucf54\ub4dc"}],"readingTime":5.14,"hasTruncateMarker":false,"authors":[{"name":"thunder","title":"\uac1c\ubc1c\uc790","url":"https://github.com/pie0902","page":{"permalink":"/docs/blog/authors/thunder"},"socials":{"github":"https://github.com/pie0902"},"key":"thunder"}],"frontMatter":{"title":"\ub3d9\uc2dc\uc131 \uc81c\uc5b4\uc640 \uc2a4\ucf00\uc904\ub9c1\uc744 \ud1b5\ud55c \ud6a8\uacfc\uc801\uc778 \uc8fc\ubb38 \ubc0f \uc7ac\uace0 \uad00\ub9ac \uc804\ub7b5","date":"2024-10-16T00:00:00.000Z","authors":["thunder"],"tags":["til","https","java","network","os","spring","testing"]},"unlisted":false,"prevItem":{"title":"\ub3d9\uc2dc\uc131 \uc81c\uc5b4\uc5d0\uc11c \uc8fc\ubb38 \ucde8\uc18c \ud1b5\ubcf4: Amazon SES\ub97c \ud65c\uc6a9\ud55c \uba54\uc77c \uc804\uc1a1 \uc804\ub7b5","permalink":"/docs/blog/til/\ub3d9\uc2dc\uc131-\uc81c\uc5b4\uc5d0\uc11c-\uc8fc\ubb38-\ucde8\uc18c-\ud1b5\ubcf4-amazon-ses\ub97c-\ud65c\uc6a9\ud55c-\uba54\uc77c-\uc804\uc1a1-\uc804\ub7b5"},"nextItem":{"title":"\ubc30\ud3ec \ud658\uacbd\uc744 \uc704\ud55c \ub2e8\uc77c Redis \uc778\uc2a4\ud134\uc2a4: AWS ElasticCache \ud65c\uc6a9\ubc95","permalink":"/docs/blog/til/\ubc30\ud3ec-\ud658\uacbd\uc744-\uc704\ud55c-\ub2e8\uc77c-redis-\uc778\uc2a4\ud134\uc2a4-aws-elasticcache-\ud65c\uc6a9\ubc95"}}')},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>d});var t=r(96540);const i={},s=t.createContext(i);function l(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(s.Provider,{value:n},e.children)}},81294:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});var t=r(11472),i=r(74848),s=r(28453);const l={title:"\ub3d9\uc2dc\uc131 \uc81c\uc5b4\uc640 \uc2a4\ucf00\uc904\ub9c1\uc744 \ud1b5\ud55c \ud6a8\uacfc\uc801\uc778 \uc8fc\ubb38 \ubc0f \uc7ac\uace0 \uad00\ub9ac \uc804\ub7b5",date:new Date("2024-10-16T00:00:00.000Z"),authors:["thunder"],tags:["til","https","java","network","os","spring","testing"]},d="\ub3d9\uc2dc\uc131 \uc81c\uc5b4\uc640 \uc2a4\ucf00\uc904\ub9c1\uc744 \ud1b5\ud55c \ud6a8\uacfc\uc801\uc778 \uc8fc\ubb38 \ubc0f \uc7ac\uace0 \uad00\ub9ac \uc804\ub7b5",c={authorsImageUrls:[void 0]},o=[{value:"\ubb38\uc81c\uc810",id:"\ubb38\uc81c\uc810",level:3},{value:"\uac1c\uc120\ub41c \ub3d9\uc2dc\uc131 \uc81c\uc5b4",id:"\uac1c\uc120\ub41c-\ub3d9\uc2dc\uc131-\uc81c\uc5b4",level:3},{value:"\uac1c\uc120 \ud6a8\uacfc",id:"\uac1c\uc120-\ud6a8\uacfc",level:4},{value:"\uac1c\uc120\ub41c \ucf54\ub4dc\uc5d0\uc11c \ubc1c\uc0dd\ud55c \ubb38\uc81c",id:"\uac1c\uc120\ub41c-\ucf54\ub4dc\uc5d0\uc11c-\ubc1c\uc0dd\ud55c-\ubb38\uc81c",level:3},{value:"\uc2a4\ucf00\uc904\ub9c1\uc744 \ud1b5\ud55c \ubb38\uc81c \ud574\uacb0",id:"\uc2a4\ucf00\uc904\ub9c1\uc744-\ud1b5\ud55c-\ubb38\uc81c-\ud574\uacb0",level:3},{value:"\uac1c\uc120 \ud6a8\uacfc",id:"\uac1c\uc120-\ud6a8\uacfc-1",level:4},{value:"\uac1c\uc120\ub41c \ucf54\ub4dc",id:"\uac1c\uc120\ub41c-\ucf54\ub4dc",level:3},{value:"\uc8fc\ubb38\ud558\uae30",id:"\uc8fc\ubb38\ud558\uae30",level:4},{value:"\uc2a4\ucf00\uc904\ub9c1 \ucf54\ub4dc",id:"\uc2a4\ucf00\uc904\ub9c1-\ucf54\ub4dc",level:4},{value:"\uc77c\uc815 \uc2dc\uac04\uc774 \uc9c0\ub0ac\ub294\ub370 \uacb0\uc81c\uac00 \uc548\ub41c \uc8fc\ubb38\uc11c\ub97c \ucc3e\ub294 \ucffc\ub9ac",id:"\uc77c\uc815-\uc2dc\uac04\uc774-\uc9c0\ub0ac\ub294\ub370-\uacb0\uc81c\uac00-\uc548\ub41c-\uc8fc\ubb38\uc11c\ub97c-\ucc3e\ub294-\ucffc\ub9ac",level:4},{value:"\uc8fc\ubb38 \ucde8\uc18c&amp;\uc218\ub7c9 \ubcf5\uad6c \uc5c5\ub370\uc774\ud2b8 \ub85c\uc9c1",id:"\uc8fc\ubb38-\ucde8\uc18c\uc218\ub7c9-\ubcf5\uad6c-\uc5c5\ub370\uc774\ud2b8-\ub85c\uc9c1",level:4},{value:"\ud14c\uc2a4\ud2b8 \uacb0\uacfc",id:"\ud14c\uc2a4\ud2b8-\uacb0\uacfc",level:3},{value:"\uc0c1\ud488\uc218\ub7c9",id:"\uc0c1\ud488\uc218\ub7c9",level:4},{value:"JMeter \uc124\uc815",id:"jmeter-\uc124\uc815",level:4},{value:"\uc2e4\ud589 \uacb0\uacfc",id:"\uc2e4\ud589-\uacb0\uacfc",level:4},{value:"\uc8fc\ubb38 \ucde8\uc18c \uc2a4\ucf00\uc904\ub9c1 \uacb0\uacfc",id:"\uc8fc\ubb38-\ucde8\uc18c-\uc2a4\ucf00\uc904\ub9c1-\uacb0\uacfc",level:4},{value:"\ud14c\uc2a4\ud2b8 2 (\uc0c1\ud488 \uc218\ub7c9\uc774 1\uac1c\uc77c \ub54c \ub3d9\uc2dc\uc5d0 \ub450 \uba85\uc758 \uc0ac\uc6a9\uc790\uac00 \uc8fc\ubb38\ud588\uc744 \uacbd\uc6b0)",id:"\ud14c\uc2a4\ud2b8-2-\uc0c1\ud488-\uc218\ub7c9\uc774-1\uac1c\uc77c-\ub54c-\ub3d9\uc2dc\uc5d0-\ub450-\uba85\uc758-\uc0ac\uc6a9\uc790\uac00-\uc8fc\ubb38\ud588\uc744-\uacbd\uc6b0",level:3},{value:"\ud14c\uc2a4\ud2b8 \uacb0\uacfc",id:"\ud14c\uc2a4\ud2b8-\uacb0\uacfc-1",level:4}];function a(e){const n={code:"code",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["\ub3d9\uc2dc\uc131 \uc81c\uc5b4\ub97c \uc801\uc6a9\ud55c \ubd80\ubd84\uc5d0\uc11c \ubb38\uc81c\ub97c \ubc1c\uacac\ud588\ub2e4.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\uc6d0\ub798\uc758 \uc8fc\ubb38 \ucc98\ub9ac \ud750\ub984\uc5d0\uc11c\uc758 \ub3d9\uc2dc\uc131 \uc81c\uc5b4",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/933daefd-4f31-4adc-929d-4de1b306f480",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 2 55 23"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\ubb38\uc81c\uc810",children:"\ubb38\uc81c\uc810"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\ub77d\uc744 \uac78\uc5b4\ub1a8\uc9c0\ub9cc \uacb0\uc81c\uac00 \uc644\ub8cc\ub41c \uc2dc\uc810\uc5d0\uc11c \uc218\ub7c9\uc774 \uc5c5\ub370\uc774\ud2b8 \ub418\uae30 \ub54c\ubb38\uc5d0 \uc218\ub7c9\uc774 1\uac1c\ub77c\uace0 \ud574\ub3c4 \uc8fc\ubb38\uc11c\uac00 100\uac1c\uac00 \uc0dd\uae38 \uc218\uac00 \uc788\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"a\uc640 b\uc758 \uc8fc\ubb38\uc11c\uac00 \uc0dd\uae30\uace0 a\uc640 b \ub458 \ub2e4 \uacb0\uc81c\ucc3d\uc5d0 \uc9c4\uc785\ud55c\ub2e4. \ub458 \ub2e4 \uacb0\uc81c\uac00 \uc9c4\ud589 \ub41c \ud6c4\uc5d0 \uc218\ub7c9\uc774 1\uac1c\ub9cc \uc904\uc5b4\ub4e4 \uc704\ud5d8\uc774 \uc788\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"\uc9c0\uae08\uc740 \uacb0\uc81c \ubaa8\ub4c8\ub85c \uce74\uce74\uc624 API\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub294\ub370 \ub2e4\ub978 \uacb0\uc81c \ubaa8\ub4c8\ub4e4\uc744 \uac00\uc9c0\uace0 \uc654\uc744\ub54c \uadf8 \ubaa8\ub4c8\ub4e4\uc5d0\ub3c4 \ub77d\uc744 \uac78\uc5b4\uc918\uc57c \ud55c\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"\uac1c\uc120\ub41c-\ub3d9\uc2dc\uc131-\uc81c\uc5b4",children:"\uac1c\uc120\ub41c \ub3d9\uc2dc\uc131 \uc81c\uc5b4"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\ubd84\uc0b0 \ub77d\uc744 \uc801\uc6a9\ud560 \uc815\ud655\ud55c \uc2dc\uc810\uc744 \uace0\ubbfc\ud574\ubcf4\uace0 \uc8fc\ubb38\ud558\uae30\uc5d0 \ub77d\uc744 \uac78\uc5b4\uc11c \ub3d9\uc2dc\uc131\uc744 \uc81c\uc5b4 \ud588\ub2e4.\n",(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/9453d581-3c5e-4bbd-b809-189879b64c4f",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 16 50"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\uac1c\uc120-\ud6a8\uacfc",children:"\uac1c\uc120 \ud6a8\uacfc"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\uc8fc\ubb38\ud558\uae30 \uc790\uccb4\uc5d0 \ub77d\uc744 \uac78\uc5b4\uc11c \uc7ac\uace0\uac00 1\uc77c \ub54c A,B\uac00 \ub3d9\uc2dc\uc5d0 \uc8fc\ubb38\ud574\ub3c4 \ud55c \uba85\ub9cc \uacb0\uc81c\uac00 \ub420 \uc218 \uc788\ub3c4\ub85d \uac1c\uc120\ud588\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"100\uba85 1000\uba85\uc774 \uc2dc\ub3c4\ud574\ub3c4 \uc7ac\uace0\uac00 10\uac1c\uba74 10\uac1c\ub9cc \ubc1b\uace0 \uae54\ub054\ud558\uac8c 10\uba85\ub9cc \uacb0\uc81c\ud558\uae30\ub85c \ub118\uc5b4\uac08 \uc218 \uc788\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"\uac1c\uc120\ub41c-\ucf54\ub4dc\uc5d0\uc11c-\ubc1c\uc0dd\ud55c-\ubb38\uc81c",children:"\uac1c\uc120\ub41c \ucf54\ub4dc\uc5d0\uc11c \ubc1c\uc0dd\ud55c \ubb38\uc81c"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\uc218\ub7c9\uc774 100\uac1c\uc778 \uc0c1\ud488\uc744 \uc5b4\ub5a4 \uc720\uc800 \ud55c\uba85\uc774 100\uac1c\ub97c \uc8fc\ubb38\ud574\ub193\uace0 \uacb0\uc81c\ub97c \uc548\ud558\uba74 \ub2e4\ub978\uc0ac\ub78c\uc774 \uacb0\uc81c\ub97c \ud560 \uc218\uac00 \uc5c6\ub2e4.",(0,i.jsx)("br",{}),"\nex) \uc8fc\ubb38\ub7c9 \ube4c\ub7f0",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/b87e1c43-d07a-4607-8e53-ff5ea0979b79",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 23 23"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\uc2a4\ucf00\uc904\ub9c1\uc744-\ud1b5\ud55c-\ubb38\uc81c-\ud574\uacb0",children:"\uc2a4\ucf00\uc904\ub9c1\uc744 \ud1b5\ud55c \ubb38\uc81c \ud574\uacb0"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'\uc8fc\ubb38\ud558\uae30 \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uba74 "5\ubd84 \uc774\ub0b4\uc5d0 \uacb0\uc81c\uac00 \uc644\ub8cc\ub418\uc9c0 \uc54a\uc73c\uba74 \uc8fc\ubb38\uc774 \uc790\ub3d9\uc73c\ub85c \ucde8\uc18c\ub429\ub2c8\ub2e4."\ub77c\ub294 \ud31d\uc5c5 \uba54\uc2dc\uc9c0\ub97c \ud45c\uc2dc\ud55c\ub2e4. \uc774\uc640 \ud568\uaed8 \uc2a4\ucf00\uc904\ub9c1 \uae30\ub2a5\uc744 \ub3c4\uc785\ud558\uc5ec, \uc8fc\ubb38 \ud6c4 5\ubd84 \uc774\ub0b4\uc5d0 \uacb0\uc81c\uac00 \uc774\ub8e8\uc5b4\uc9c0\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \ud574\ub2f9 \uc8fc\ubb38\uc744 \uc790\ub3d9\uc73c\ub85c \ucde8\uc18c \ucc98\ub9ac\ud558\uace0 \uc8fc\ubb38\ub41c \uc218\ub7c9\ub9cc\ud07c \uc7ac\uace0\ub97c \ubcf5\uc6d0\ud55c\ub2e4.'}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\uac1c\uc120-\ud6a8\uacfc-1",children:"\uac1c\uc120 \ud6a8\uacfc"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\ubbf8\uacb0\uc81c \uc8fc\ubb38\uc73c\ub85c \uc778\ud55c \uc7ac\uace0 \ub0ad\ube44\uc640 \ud310\ub9e4 \uae30\ud68c \uc190\uc2e4\uc744 \ucd5c\uc18c\ud654\ud560 \uc218 \uc788\uac8c \ub418\uc5c8\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"\uc0ac\uc6a9\uc790 \uacbd\ud5d8 \uce21\uba74\uc5d0\uc11c\ub3c4 \uacb0\uc81c \uc644\ub8cc\uc5d0 \ub300\ud55c \uc801\uc808\ud55c \uc548\ub0b4\ub97c \uc81c\uacf5\ud558\uace0, \ubcf4\ub2e4 \ud6a8\uc728\uc801\uc778 \uc8fc\ubb38 \ucc98\ub9ac \ud750\ub984\uc744 \uc81c\uacf5\ud560 \uc218 \uc788\uac8c \ub418\uc5c8\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"\uac1c\uc120\ub41c-\ucf54\ub4dc",children:"\uac1c\uc120\ub41c \ucf54\ub4dc"}),"\n",(0,i.jsx)(n.h4,{id:"\uc8fc\ubb38\ud558\uae30",children:"\uc8fc\ubb38\ud558\uae30"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'    public void createOrder(\n            Map<Long, Long> basket,\n            UserDetailsImpl userDetails,\n            Long addressId\n    ) {\n        String lockKey = "order_lock";\n        RLock lock = redissonClient.getLock(lockKey);\n        try {\n          boolean isLocked = lock.tryLock(5, 10, TimeUnit.SECONDS);\n          if (!isLocked) {\n            throw new RuntimeException("\ub77d \ud68d\ub4dd\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.");\n          }\n      \n          // \uc0c1\ud488 \uc218\ub7c9 \uac80\uc99d \ucf54\ub4dc\n          checkBasket(basket);\n      \n          // \uc8fc\ubb38 \uac1d\uccb4 \uc0dd\uc131\n          Order order = new Order(userDetails.getUser().getId(), OrderState.NOTPAYED, addressId);\n      \n          // \uc8fc\ubb38 \uac1d\uccb4 \uc800\uc7a5\n          orderRepository.save(order);\n      \n          // \uc7a5\ubc14\uad6c\ub2c8\ub97c \uc21c\ud68c\ud558\uba70\n          // \uc8fc\ubb38\ud55c \uc0c1\ud488\uacfc \uc0c1\ud488 \uac1c\uc218\ub97c \uc0c1\ud488 \uc0c1\uc138\uc815\ubcf4 \ud14c\uc774\ube14\uc5d0 \uc5c5\ub370\uc774\ud2b8\n          // \uc0c1\ud488 \ud14c\uc774\ube14\uc758 \uc0c1\ud488 \uc218\ub7c9 \uc5c5\ub370\uc774\ud2b8\n          for (Map.Entry<Long, Long> entry : basket.entrySet()) {\n            Long productId = entry.getKey();\n            Long quantity = entry.getValue();\n      \n            // \uc0c1\ud0dc\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uba54\uc11c\ub4dc\n            updateStockAndCreateOrderDetail(productId, quantity, order);\n          }\n        } catch (InterruptedException e) {\n          throw new RuntimeException("\ub77d \ud68d\ub4dd \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.", e);\n        } finally {\n          if (lock.isLocked()) {\n            lock.unlock();\n          }\n        }\n      }\n\n    //\uc0c1\ud0dc\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uba54\uc11c\ub4dc\n    @Transactional\n    public void updateStockAndCreateOrderDetail(Long productId, Long quantity, Order order) {\n        //\uc601\uc18d\uc131 \ucee8\ud14d\uc2a4\ud2b8\ub97c \ucd08\uae30\ud654\n        entityManager.clear();\n        //\uc0c1\ud488 \uac1d\uccb4 \uc0dd\uc131\n        Product product = productService.getProduct(productId);\n        //\uc0c1\ud488 \uc218\ub7c9 \uc218\uc815\n        product.updateStockAfterOrder(quantity);\n        System.out.println("\ud604\uc7ac \uc0c1\ud488 \uc218\ub7c9: " + product.getStock());\n        //\uc218\uc815\ub41c \uc0c1\ud488 \uc800\uc7a5\n        productService.save(product);\n        //\uc0c1\ud488 \uc0c1\uc138\uc815\ubcf4 \uac1d\uccb4 \uc800\uc7a5\n        OrderDetail orderDetail = new OrderDetail(order.getId(), productId, quantity, product.getPrice(), product.getName());\n        orderDetailRepository.save(orderDetail);\n    }\n\n'})}),"\n",(0,i.jsx)(n.h4,{id:"\uc2a4\ucf00\uc904\ub9c1-\ucf54\ub4dc",children:"\uc2a4\ucf00\uc904\ub9c1 \ucf54\ub4dc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"    @Configuration\n    @EnableScheduling\n    public class SchedulingConfig {\n    }\n\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uc2a4\ucf00\uc904\ub9c1 \uae30\ub2a5\uc744 \ud65c\uc131\ud654\ud558\uae30 \uc704\ud55c Spring \uc124\uc815 \ud074\ub798\uc2a4 \ub9cc\ub4e0\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\uc77c\uc815-\uc2dc\uac04\uc774-\uc9c0\ub0ac\ub294\ub370-\uacb0\uc81c\uac00-\uc548\ub41c-\uc8fc\ubb38\uc11c\ub97c-\ucc3e\ub294-\ucffc\ub9ac",children:"\uc77c\uc815 \uc2dc\uac04\uc774 \uc9c0\ub0ac\ub294\ub370 \uacb0\uc81c\uac00 \uc548\ub41c \uc8fc\ubb38\uc11c\ub97c \ucc3e\ub294 \ucffc\ub9ac"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'    @Query("SELECT o FROM Order o WHERE o.state = \'NOTPAYED\' AND o.createdAt < :cutoff")\n    List<Order> findUnpaidOrdersOlderThan(@Param("cutoff") LocalDateTime cutoff);\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"OrderRepository\uc5d0 \ucffc\ub9ac\ub97c \uc791\uc131\ud55c\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\uc8fc\ubb38-\ucde8\uc18c\uc218\ub7c9-\ubcf5\uad6c-\uc5c5\ub370\uc774\ud2b8-\ub85c\uc9c1",children:"\uc8fc\ubb38 \ucde8\uc18c&\uc218\ub7c9 \ubcf5\uad6c \uc5c5\ub370\uc774\ud2b8 \ub85c\uc9c1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'    @Scheduled(fixedDelay = 10000) // 10\ucd08\uc5d0 \ud55c\ubc88\uc529 \uc2e4\ud589\n    public void cancelUnpaidOrdersAndRestoreStock(\n    ) {\n      //\uc2dc\uac04 \uc124\uc815 \ubcc0\uc218 \uc120\uc5b8\n      LocalDateTime MinutesAgo = LocalDateTime.now().minus(30, ChronoUnit.SECONDS); //\ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 10\ucd08\ub85c \uc124\uc815\n      // MinutesAgo \ubcc0\uc218 \uc124\uc815 \uc2dc\uac04 \uc774\uc0c1 \ubbf8\uacb0\uc81c \uc8fc\ubb38 \uc870\ud68c\n      List<Order> unpaidOrders = orderRepository.findUnpaidOrdersOlderThan(MinutesAgo);\n      //\uc77c\uc815 \uc2dc\uac04\uc774 \uc9c0\ub09c order \ub9ac\uc2a4\ud2b8\ub97c \uc21c\ud68c \ud558\uba70 \uc8fc\ubb38\uc744 \ucde8\uc18c \uc2dc\ud0a4\uace0 \uc7ac\uace0\ub97c \ubcf5\uad6c\ud568\n      for (Order order : unpaidOrders) {\n        if (order.getState() == OrderState.NOTPAYED) {\n          order.changeState(OrderState.CANCELLED);\n          orderRepository.save(order);\n          restoreStock(order); // \uc7ac\uace0 \ubcf5\uad6c \ub85c\uc9c1\n        }\n      }\n    }\n\n    @Transactional\n    public void restoreStock(\n            Order order\n    ) {\n      //\uc8fc\ubb38\uc11c\uc758 id\ub97c \uac00\uc9c4 \uc8fc\ubb38 \uc0c1\uc138\ub97c \uac00\uc838\uc634\n      List<OrderDetail> orderDetails = orderDetailRepository.findByOrderId(order.getId());\n      //\uc8fc\ubb38 \uc0c1\uc138\ud45c\ub4e4\uc744 \uc21c\ud68c\n      for (OrderDetail detail : orderDetails) {\n        //100\uba85\uc774 \ud55c\uaebc\ubc88\uc5d0 \uc8fc\ubb38\ud558\uba74 \ud55c\uaebc\ubc88\uc5d0 \ucde8\uc18c\ud558\ub294 \uc0c1\ud669\uc5d0\ub3c4 \ub3d9\uc2dc\uc131\uc774 \ud544\uc694\ud568\n        //\ub77d \uc801\uc6a9\n        String lockKey = "productLock:" + detail.getProductId();\n        RLock rLock = redissonClient.getLock(lockKey);\n        boolean isLocked = false;\n    \n        try {\n          isLocked = rLock.tryLock(5, 10, TimeUnit.SECONDS);\n          if (!isLocked) {\n            throw new RuntimeException("Unable to lock the product stock for product ID: "\n                    + detail.getProductId());\n          }\n          //\uc8fc\ubb38 \uc0c1\uc138\uc5d0 \uc788\ub294 \uc0c1\ud488 \uac1d\uccb4\ub97c \ubd88\ub7ec\uc634\n          //\uc0c1\ud488 \uac1d\uccb4\uc758 \uc218\ub7c9\uc744 \ubcf5\uad6c\n          Product product = productService.getProduct(detail.getProductId());\n          product.updateStockAfterOrder(-detail.getQuantity());\n          System.out.println("\ubcf5\uad6c" + product.getStock());\n          productService.save(product);\n    \n        } catch (InterruptedException e) {\n          Thread.currentThread().interrupt();\n          throw new RuntimeException("Lock acquisition interrupted", e);\n    \n        } finally {\n          if (isLocked && rLock.isLocked()) {\n            rLock.unlock();\n          }\n        }\n      }\n    }\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"JMeter\ub85c \ud14c\uc2a4\ud2b8\ub97c \ud558\uae30 \uc704\ud574 \uc8fc\ubb38 \ucde8\uc18c \ub85c\uc9c1\uc758 \uc2e4\ud589 \uc2dc\uac04\uc744 10\ucd08\ub85c \uc124\uc815\ud588\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"JMeter\ub85c \ud14c\uc2a4\ud2b8\ub97c \ud558\uae30 \uc704\ud574 \uc8fc\ubb38 \ud55c \ub4a4\uc5d0 \uacb0\uc81c\ub97c \uc548\ud588\uc744\ub54c \uc8fc\ubb38\uc774 \ucde8\uc18c\ub418\ub294 \uc2dc\uc810\uc744 30\ucd08\ub85c \uc124\uc815\ud588\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\ud14c\uc2a4\ud2b8-\uacb0\uacfc",children:"\ud14c\uc2a4\ud2b8 \uacb0\uacfc"}),"\n",(0,i.jsx)(n.h4,{id:"\uc0c1\ud488\uc218\ub7c9",children:"\uc0c1\ud488\uc218\ub7c9"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/776648a0-17c1-46cf-9c0f-53b6f065bcf1",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 47 03"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uc218\ub7c9\uc744 1000\uac1c\ub85c \uc124\uc815"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"jmeter-\uc124\uc815",children:"JMeter \uc124\uc815"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/2ecf635a-5a35-44ec-b203-0c10ea755d30",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 52 58"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"JMeter \uc2a4\ub808\ub4dc\ub97c 100\uac1c\ub85c \uc124\uc815"}),"\n",(0,i.jsx)(n.li,{children:"user.csv\uc5d0 \uae30\uc874 \ub370\uc774\ud130 \ubca0\uc774\uc2a4\uc758 \uc720\uc800 100\uba85\uc744 \ub123\uc5b4\uc11c JMeter\uc5d0 \uc5c5\ub370\uc774\ud2b8"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\uc2e4\ud589-\uacb0\uacfc",children:"\uc2e4\ud589 \uacb0\uacfc"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/c0db8da6-e8a0-4cff-b82b-deca15652937",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 56 09"}),"\n",(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/192d4f46-189f-48aa-b1f7-71847a637d84",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 56 23"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ub3d9\uc2dc\uc131\uc774 \uc798 \uc801\uc6a9\ub3fc\uc11c \uc218\ub7c9\uc774 100\uac1c\uac00 \uc21c\ucc28\uc801\uc73c\ub85c \uc904\uc5b4\ub4dc\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/a0391770-906e-4681-b731-7f8c1458f791",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 55 43"}),"\n*\uc8fc\ubb38\uc11c \uc0c1\ud0dc\uac00 NOTPAYED\ub85c \uc131\uacf5\uc801\uc73c\ub85c 100\uac1c \ub9cc\ud07c \uc798 \uc0dd\uc131 \ub418\uc5c8\ub2e4."]}),"\n",(0,i.jsx)(n.h4,{id:"\uc8fc\ubb38-\ucde8\uc18c-\uc2a4\ucf00\uc904\ub9c1-\uacb0\uacfc",children:"\uc8fc\ubb38 \ucde8\uc18c \uc2a4\ucf00\uc904\ub9c1 \uacb0\uacfc"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/a11f5ff5-2322-43d7-8d65-7f9cb8027280",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 56 44"}),"\n",(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/f1dc0091-5e3b-4170-ba4c-72df4cafcb9f",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 56 55"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uc8fc\ubb38\uc744 \ud558\uace0 \uc124\uc815\ud574\ub193\uc740 \uc2dc\uac04\ub3d9\uc548 \uacb0\uc81c\ub97c \ud558\uc9c0 \uc54a\uc544\uc11c \uc2a4\ucf00\uc904\ub9c1\uc744 \uc801\uc6a9\ud55c \ucf54\ub4dc\uac00 \uc2e4\ud589\ub3fc\uc11c \uc218\ub7c9\uc774 \uc131\uacf5\uc801\uc73c\ub85c \ubcf5\uad6c \ub418\ub294\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/ca5da31d-48c1-42ba-b5fe-8048be06d4b7",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 3 59 57"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uc8fc\ubb38\uc11c\uc758 \uc0c1\ud0dc\uac00 CANCELLED\ub85c \uc131\uacf5\uc801\uc73c\ub85c \ubc14\ub010\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\ud14c\uc2a4\ud2b8-2-\uc0c1\ud488-\uc218\ub7c9\uc774-1\uac1c\uc77c-\ub54c-\ub3d9\uc2dc\uc5d0-\ub450-\uba85\uc758-\uc0ac\uc6a9\uc790\uac00-\uc8fc\ubb38\ud588\uc744-\uacbd\uc6b0",children:"\ud14c\uc2a4\ud2b8 2 (\uc0c1\ud488 \uc218\ub7c9\uc774 1\uac1c\uc77c \ub54c \ub3d9\uc2dc\uc5d0 \ub450 \uba85\uc758 \uc0ac\uc6a9\uc790\uac00 \uc8fc\ubb38\ud588\uc744 \uacbd\uc6b0)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"JMeter\uc5d0 \uc2a4\ub808\ub4dc\ub97c 2\uac1c\ub85c \uc124\uc815\ud55c\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"\uc0c1\ud488\uc758 \uc218\ub7c9\uc744 1\uac1c\ub85c \ubcc0\uacbd\ud55c\ub2e4."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\ud14c\uc2a4\ud2b8-\uacb0\uacfc-1",children:"\ud14c\uc2a4\ud2b8 \uacb0\uacfc"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://github.com/pie0902/TIL/assets/47919911/5968308e-e745-4410-9090-a48c56c2b315",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2024-04-17 \u110b\u1169\u1112\u116e 4 10 52"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ub3d9\uc2dc\uc131\uc774 \uc131\uacf5\uc801\uc73c\ub85c \uc81c\uc5b4\uac00 \ub3fc\uc11c 1\ubc88 \uc720\uc800\ub294 \uc8fc\ubb38\uc5d0 \uc131\uacf5\ud558\uace0 2\ubc88 \uc720\uc800\ub294 \uc8fc\ubb38\uc5d0 \uc2e4\ud328\ud55c\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"10\ucd08 \ub4a4\uc5d0 1\ubc88 \uc720\uc800\uac00 \uacb0\uc81c\ub97c \uc548\ud574\uc11c \ub2e4\uc2dc \uc218\ub7c9\uc774 \ubcf5\uad6c\ub418\uace0 order\uc758 \uc0c1\ud0dc\uac00 CANCELLED\ub85c \ubcc0\uacbd\ub41c\ub2e4."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);