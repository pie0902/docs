"use strict";(globalThis.webpackChunkmy_portfolio=globalThis.webpackChunkmy_portfolio||[]).push([[39107],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},33101:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var i=t(37592),s=t(74848),r=t(28453);const o={title:"BerkInsert\ub97c \uc0ac\uc6a9\ud55c \ucffc\ub9ac \uac1c\uc120",date:new Date("2024-10-16T00:00:00.000Z"),authors:["thunder"],tags:["dev","java-springboot","database","java","jpa","sql"]},a="BerkInsert\ub97c \uc0ac\uc6a9\ud55c \ucffc\ub9ac \uac1c\uc120",d={authorsImageUrls:[void 0]},l=[{value:"\ubb38\uc81c\uac00 \ubc1c\uacac\ub41c \ucf54\ub4dc",id:"\ubb38\uc81c\uac00-\ubc1c\uacac\ub41c-\ucf54\ub4dc",level:2},{value:"createPost\ub97c \uc2e4\ud589\ud55c \uacb0\uacfc",id:"createpost\ub97c-\uc2e4\ud589\ud55c-\uacb0\uacfc",level:2},{value:"\uc2a4\ud06c\ub9b0\uc0f7 \ub300\uc2e0 \ub9c8\ud06c\ub2e4\uc6b4 \ud14c\uc774\ube14 \ud45c\ub85c \ub300\uc2e0\ud558\uaca0\uc2b5\ub2c8\ub2e4..",id:"\uc2a4\ud06c\ub9b0\uc0f7-\ub300\uc2e0-\ub9c8\ud06c\ub2e4\uc6b4-\ud14c\uc774\ube14-\ud45c\ub85c-\ub300\uc2e0\ud558\uaca0\uc2b5\ub2c8\ub2e4",level:3},{value:"\uc5b4\ub5bb\uac8c \ud574\uacb0 \ud560 \uac83\uc778\uac00?",id:"\uc5b4\ub5bb\uac8c-\ud574\uacb0-\ud560-\uac83\uc778\uac00",level:2},{value:"1. \ucc98\uc74c\uc5d0 Batch \uae30\ubc95\uc744 \uc0dd\uac01\ud588\ub2e4.",id:"1-\ucc98\uc74c\uc5d0-batch-\uae30\ubc95\uc744-\uc0dd\uac01\ud588\ub2e4",level:3},{value:"2. Batch\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud55c \uc774\uc720",id:"2-batch\ub97c-\uc0ac\uc6a9\ud558\uc9c0-\ubabb\ud55c-\uc774\uc720",level:3},{value:"3. BerkInsert\ub97c \uc0ac\uc6a9\ud55c \uc774\uc720",id:"3-berkinsert\ub97c-\uc0ac\uc6a9\ud55c-\uc774\uc720",level:3},{value:"\ud574\uacb0\ud55c \uacfc\uc815",id:"\ud574\uacb0\ud55c-\uacfc\uc815",level:2},{value:"BerkInsert \uc801\uc6a9 \uc804",id:"berkinsert-\uc801\uc6a9-\uc804",level:3},{value:"BerkInsert \uc801\uc6a9 \ud6c4",id:"berkinsert-\uc801\uc6a9-\ud6c4",level:3},{value:"\ud574\uacb0\ub41c \ud6c4 \ucffc\ub9ac \uc2e4\ud589 \uacb0\uacfc",id:"\ud574\uacb0\ub41c-\ud6c4-\ucffc\ub9ac-\uc2e4\ud589-\uacb0\uacfc",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\ubb38\uc81c\uac00-\ubc1c\uacac\ub41c-\ucf54\ub4dc",children:"\ubb38\uc81c\uac00 \ubc1c\uacac\ub41c \ucf54\ub4dc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'//post \uc0dd\uc131\n@Transactional\npublic PostResponse createPost(\n    PostRequest postRequest,\n    HttpServletRequest request,\n    Long boardId\n){\n    //\ud1a0\ud070 \uc0dd\uc131\n    String token = jwtUtils.validateTokenOrThrow(request);\n    //userId \ucd94\ucd9c\ud574\uc11c Long\uc73c\ub85c \ubcc0\uacbd\n    Long tokenUserId = Long.parseLong(jwtUtils.getUserIdFromToken(token));\n    String username = userRepository.findById(tokenUserId)\n        .orElseThrow(() -> new ApplicationException("\uc5c6\ub294 \uc720\uc800", HttpStatus.NOT_FOUND))\n        .getUsername();\n    //post \uac1d\uccb4 \uc0dd\uc131\n    Post post = new Post(postRequest.getTitle(),postRequest.getContent(),tokenUserId,boardId);\n    postRepository.save(post);\n    // \uc800\uc7a5 \ud6c4 ID\uac00 \uc0dd\uc131\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\n    if (post.getId() == null) {\n    throw new ApplicationException("Failed to save the post, ID is null!", HttpStatus.INTERNAL_SERVER_ERROR);\n    }\n    //post \uac1d\uccb4 \uc800\uc7a5\n    \n    \n    //*********************\uc911\uc694*************************************//\n    notificationDomainService.giveNotification(boardId,post.getId());\n    //**************************************************************//\n    \n    \n    //postResponse DTO \uc0dd\uc131\n    PostResponse postResponse = new PostResponse(post.getId(),post.getTitle(),post.getContent(),tokenUserId,username,post.getCreatedAt(),post.getViews());\n    //postResponse DTO \ubc18\ud658\n    return postResponse;\n}\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\ucffc\ub9ac\uac1c\uc120\uc744 \ud558\ub294 \uc911\uc5d0 \uc9c4\uc9dc \uc2ec\uac01\ud55c \ubb38\uc81c\ub97c \ubc1c\uacac\ud588\ub2e4.."}),(0,s.jsx)("br",{}),'\n\ubc14\ub85c \uc800\uae30 \uc911\uc694\ub77c\uace0 \uc8fc\uc11d\ucc98\ub9ac\ub41c \ucf54\ub4dc\uc774\ub2e4. \ud3ec\uc2a4\ud2b8\uac00 \uc791\uc131\ub418\uba74 \uac19\uc740 \ubcf4\ub4dc\uc5d0 \uc788\ub294 \uc0ac\ub78c\ub4e4\uc5d0\uac8c "user"\uac00 \uac8c\uc2dc\uae00\uc744 \uc791\uc131\ud588\uc2b5\ub2c8\ub2e4 \ub77c\uace0 \uc54c\ub9bc\uc744 \ubcf4\ub0b4\uc8fc\ub294 \uae30\ub2a5\uc744 \ud558\ub294 \ucf54\ub4dc\uc774\ub2e4.\n',(0,s.jsx)("br",{}),"\ubb38\uc81c\ub97c \ud55c\ubc88 \ubcf4\uc790"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"createpost\ub97c-\uc2e4\ud589\ud55c-\uacb0\uacfc",children:"createPost\ub97c \uc2e4\ud589\ud55c \uacb0\uacfc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Hibernate",children:"2024-07-02 18:11:21.097 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\nselect\nuser0_.id as id1_4_0_,\nuser0_.email as email2_4_0_,\nuser0_.password as password3_4_0_,\nuser0_.username as username4_4_0_\nfrom\nuser user0_\nwhere\nuser0_.id=?\nHibernate:\nselect\nuser0_.id as id1_4_0_,\nuser0_.email as email2_4_0_,\nuser0_.password as password3_4_0_,\nuser0_.username as username4_4_0_\nfrom\nuser user0_\nwhere\nuser0_.id=?\n-- ------------------------------ 1\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.191 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.post.entity.Post\n/ insert\ninto\npost\n(created_at, updated_at, board_id, content, title, user_id, views)\nvalues\n(?, ?, ?, ?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.post.entity.Post\n*/ insert\ninto\npost\n(created_at, updated_at, board_id, content, title, user_id, views)\nvalues\n(?, ?, ?, ?, ?, ?, ?)\n-- ------------------------------ 1\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.224 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* SELECT\nnew org.example.creww.post.dto.PostWithUser(p.id,\np.title,\nu.id,\nu.username)\nFROM\nPost p\nJOIN\nUser u\nON p.userId = u.id\nWHERE\np.id = :postId / select\npost0_.id as col_0_0_,\npost0_.title as col_1_0_,\nuser1_.id as col_2_0_,\nuser1_.username as col_3_0_\nfrom\npost post0_\ninner join\nuser user1_\non (\npost0_.user_id=user1_.id\n)\nwhere\npost0_.id=?\nHibernate:\n/ SELECT\nnew org.example.creww.post.dto.PostWithUser(p.id,\np.title,\nu.id,\nu.username)\nFROM\nPost p\nJOIN\nUser u\nON p.userId = u.id\nWHERE\np.id = :postId */ select\npost0_.id as col_0_0_,\npost0_.title as col_1_0_,\nuser1_.id as col_2_0_,\nuser1_.username as col_3_0_\nfrom\npost post0_\ninner join\nuser user1_\non (\npost0_.user_id=user1_.id\n)\nwhere\npost0_.id=?\n-- ------------------------------ 1\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.232 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* SELECT\nub.userId\nFROM\nUserBoard ub\nWHERE\nub.boardId = :boardId\nAND ub.isExited = false / select\nuserboard0_.user_id as col_0_0_\nfrom\nuser_board userboard0_\nwhere\nuserboard0_.board_id=?\nand userboard0_.is_exited=0\nHibernate:\n/ SELECT\nub.userId\nFROM\nUserBoard ub\nWHERE\nub.boardId = :boardId\nAND ub.isExited = false */ select\nuserboard0_.user_id as col_0_0_\nfrom\nuser_board userboard0_\nwhere\nuserboard0_.board_id=?\nand userboard0_.is_exited=0\n-- ------------------------------ 1\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.238 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.notification.entity.Notification\n/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.notification.entity.Notification\n*/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\n-- ------------------------------ 1\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.243 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.notification.entity.Notification\n/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.notification.entity.Notification\n*/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\n-- ------------------------------ 2\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.244 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.notification.entity.Notification\n/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.notification.entity.Notification\n*/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\n-- ------------------------------ 3\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.246 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.notification.entity.Notification\n/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.notification.entity.Notification\n*/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\n-- ------------------------------ 4\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.247 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.notification.entity.Notification\n/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.notification.entity.Notification\n*/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\n-- ------------------------------ 5\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.248 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.notification.entity.Notification\n/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.notification.entity.Notification\n*/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\n-- ------------------------------ 6\ud68c \uc2e4\ud589 ------------------------------\n2024-07-02 18:11:21.249 DEBUG 5771 --- [nio-8080-exec-2] org.hibernate.SQL                        :\n/* insert org.example.creww.notification.entity.Notification\n/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\nHibernate:\n/ insert org.example.creww.notification.entity.Notification\n*/ insert\ninto\nnotification\n(created_at, is_read, message, user_id)\nvalues\n(?, ?, ?, ?)\n-------------------------------- 7\ud68c \uc2e4\ud589 ------------------------------\n\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ucffc\ub9ac\ub97c \ubd84\uc11d\ud574\ubcf4\uba74 \ub2e4\ub978 \ubd80\ubd84\ub4e4\ub3c4 \ucd5c\uc801\ud654\uac00 \ud544\uc694\ud558\ub2e4 \ud558\uc9c0\ub9cc notification\uc5d0 \uc54c\ub9bc\uc744 insert \ud558\ub294 \ucffc\ub9ac\uac00 7\ubc88\uc774\ub098 \uc2e4\ud589\ub418\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\ub2e4."}),"\n",(0,s.jsx)(n.li,{children:"UserBoard \ud14c\uc774\ube14\uc744 \ubcf4\uba74 \uc774\uc720\ub97c \uc54c \uc218 \uc788\ub2e4."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\uc2a4\ud06c\ub9b0\uc0f7-\ub300\uc2e0-\ub9c8\ud06c\ub2e4\uc6b4-\ud14c\uc774\ube14-\ud45c\ub85c-\ub300\uc2e0\ud558\uaca0\uc2b5\ub2c8\ub2e4",children:"\uc2a4\ud06c\ub9b0\uc0f7 \ub300\uc2e0 \ub9c8\ud06c\ub2e4\uc6b4 \ud14c\uc774\ube14 \ud45c\ub85c \ub300\uc2e0\ud558\uaca0\uc2b5\ub2c8\ub2e4.."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"userId"}),(0,s.jsx)(n.th,{children:"boardId"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"1"})]})]})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"board_id \uac00 1\uc778 board\uc5d0 \uc720\uc800\uac00 7\uba85\uc774 \uc874\uc7ac\ud574\uc11c \uc54c\ub9bc\uc744 7\uac1c\ub098 \ud55c\uac1c\uc529 \uc0dd\uc131\ud558\ub294 \uac83\uc774\ub2e4."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\uc5b4\ub5bb\uac8c-\ud574\uacb0-\ud560-\uac83\uc778\uac00",children:"\uc5b4\ub5bb\uac8c \ud574\uacb0 \ud560 \uac83\uc778\uac00?"}),"\n",(0,s.jsx)(n.h3,{id:"1-\ucc98\uc74c\uc5d0-batch-\uae30\ubc95\uc744-\uc0dd\uac01\ud588\ub2e4",children:"1. \ucc98\uc74c\uc5d0 Batch \uae30\ubc95\uc744 \uc0dd\uac01\ud588\ub2e4."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ud558\uc9c0\ub9cc \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud588\ub2e4. \uc65c\ub0d0\ud558\uba74 \uc791\ub3d9\uc774 \ub418\uc9c8 \uc54a\uc558\ub2e4."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-batch\ub97c-\uc0ac\uc6a9\ud558\uc9c0-\ubabb\ud55c-\uc774\uc720",children:"2. Batch\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud55c \uc774\uc720"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud55c \uc774\uc720\ub97c \uc54c\uc544\uc57c \ud560 \uac83 \uac19\uc544\uc11c \uc5f4\uc2ec\ud788 \ucc3e\uc544\ubd24\ub294\ub370 \uc774\uc720\ub294 \ub2e4\uc74c\uacfc \uac19\uc558\ub2e4.","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\uc601\uc18d\uc131 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc5d4\ud2f0\ud2f0 \uac1d\uccb4\ub97c \uc800\uc7a5\ud55c \ud6c4\uc5d0 Batch \uc791\uc5c5\uc774 \uc2e4\ud589\ub428"}),"\n",(0,s.jsx)(n.li,{children:"\ud558\uc9c0\ub9cc \uc5b4\uc81c \uc2dc\ub3c4\ud588\ub358 \ubc29\uc2dd\uc5d0\uc11c\ub294 \uc9c1\uc811 \ub808\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0\uc11c savaAll() \uba54\uc11c\ub4dc\ub97c \ud638\ucd9c\ud558\uc5ec Batch \uc791\uc5c5\uc744 \uc218\ud589\ud558\ub824 \ud568"}),"\n",(0,s.jsx)(n.li,{children:"\ud558\uc9c0\ub9cc \ub808\ud3ec\uc9c0\ud1a0\ub9ac\uc758 saveAll \uba54\uc11c\ub4dc\ub294 \ub0b4\ubd80\uc801\uc73c\ub85c \uac01\uac01\uc758 \uc5d4\ud2f0\ud2f0 \uac1d\uccb4\ub97c \uac1c\ubcc4\uc801\uc73c\ub85c \uc800\uc7a5\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c \ub3d9\uc791\ud568"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-berkinsert\ub97c-\uc0ac\uc6a9\ud55c-\uc774\uc720",children:"3. BerkInsert\ub97c \uc0ac\uc6a9\ud55c \uc774\uc720"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\uc77c\ub2e8 \uc65c Batch\uac00 \uc0ac\uc6a9\uc774 \uc548\ub410\ub294\uc9c0\ubcf4\ub2e4 \ube68\ub9ac \ud574\uacb0\uc744 \ud558\uace0\uc2f6\uc740 \ub9c8\uc74c\uc5d0 \ub2e4\ub978 \ubc29\ubc95\uc744 \ucc3e\uc558\ub294\ub370 \uadf8\uac83\uc774 \ubc14\ub85c BerkInsert \ubc29\ubc95\uc774\ub77c \ubc14\ub85c \uc801\uc6a9\ud588\ub2e4."}),"\n",(0,s.jsx)(n.li,{children:"\ud300 \ud504\ub85c\uc81d\ud2b8\ub97c \uc9c4\ud589\ud588\uc744 \ub2f9\uc2dc\uc5d0 \ud68c\uc758\ub97c \ud558\uba74\uc11c \ub2e4\ub978 \ud300\uc6d0\uc774 BerkInsert\ub97c \uc801\uc6a9\ud55c \ucf54\ub4dc\ub97c \uacf5\uc720\ud574\uc92c\uc5c8\ub294\ub370 \uadf8 \uacbd\ud5d8\uc774 \ub5a0\uc62c\ub790\ub2e4."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\ud574\uacb0\ud55c-\uacfc\uc815",children:"\ud574\uacb0\ud55c \uacfc\uc815"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["NotificationRepositoryCustom \uc778\ud130\ud398\uc774\uc2a4 \uc815\uc758","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"NotificationRepositoryCustom \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc815\uc758\ud558\uace0, \uadf8 \uc548\uc5d0 BulkInsert \uba54\uc11c\ub4dc\ub97c \uc120\uc5b8\ud588\ub2e4. \uc774 \uc778\ud130\ud398\uc774\uc2a4\ub294 JPA \ub808\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0\uc11c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 \ucee4\uc2a4\ud140 \uba54\uc11c\ub4dc\ub97c \uc815\uc758\ud560 \ub54c \uc0ac\uc6a9\ud55c\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"   public interface NotificationRepository extends JpaRepository <Notification,Long> ,\n    NotificationRepositoryCustom {\n    List<Notification> findByUserIdAndIsReadFalseOrderByCreatedAtDesc(Long userId);\n    }   \n    \n    public interface NotificationRepositoryCustom {\n        void bulkInsert(List<Notification> notifications);\n    }\n\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["NotificationRepositoryImpl\uc5d0\uc11c NotificationRepositoryCustom \uad6c\ud604","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"NotificationRepositoryImpl \ud074\ub798\uc2a4\ub97c \uc0dd\uc131\ud558\uace0, NotificationRepositoryCustom \uc778\ud130\ud398\uc774\uc2a4\ub97c \uad6c\ud604\ud588\ub2e4. \uc774 \ud074\ub798\uc2a4\uc5d0\uc11c BulkInsert \uba54\uc11c\ub4dc\ub97c \uc2e4\uc81c\ub85c \uad6c\ud604\ud558\ub294\ub370, JdbcTemplate\uc758 batchUpdate \uba54\uc11c\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec INSERT \ucffc\ub9ac\ub97c \uc791\uc131\ud558\uace0, BatchPreparedStatementSetter\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub77c\ubbf8\ud130\ub97c \uc124\uc815\ud588\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public class NotificationRepositoryImpl implements NotificationRepositoryCustom{\n\n    private final JdbcTemplate jdbcTemplate;\n    private final EntityManager entityManager;\n\n    @Autowired\n    public NotificationRepositoryImpl(JdbcTemplate jdbcTemplate, EntityManager entityManager) {\n        this.jdbcTemplate = jdbcTemplate;\n        this.entityManager = entityManager;\n    }\n\n    @Override\n    public void bulkInsert(List<Notification> notifications) {\n        String sql = "INSERT INTO notification (user_id, message, created_at, is_read) VALUES (?, ?, ?, ?)";\n\n        jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() {\n            @Override\n            public void setValues(PreparedStatement ps, int i) throws SQLException {\n                Notification notification = notifications.get(i);\n                ps.setLong(1, notification.getUserId());\n                ps.setString(2, notification.getMessage());\n                ps.setTimestamp(3, Timestamp.valueOf(notification.getCreatedAt()));\n                ps.setBoolean(4, notification.isRead());\n            }\n\n            @Override\n            public int getBatchSize() {\n                return notifications.size();\n            }\n        });\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["BulkInsert \uba54\uc11c\ub4dc \ud638\ucd9c","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\uae30\uc874 \ucf54\ub4dc\uc5d0\uc11c \ubc18\ubcf5\ubb38\uc73c\ub85c \uac1c\ubcc4 \uc54c\ub9bc\uc744 \uc800\uc7a5\ud558\ub358 \ubd80\ubd84\uc744 BulkInsert \uba54\uc11c\ub4dc \ud638\ucd9c\ub85c \ub300\uccb4\ud588\ub2e4. \uc774\uc81c Notification \uc5d4\ud2f0\ud2f0 \ub9ac\uc2a4\ud2b8\ub97c BulkInsert \uba54\uc11c\ub4dc\uc5d0 \uc804\ub2ec\ud558\uc5ec \ud55c \ubc88\uc5d0 INSERT \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uac8c \ub418\uc5c8\ub2e4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"berkinsert-\uc801\uc6a9-\uc804",children:"BerkInsert \uc801\uc6a9 \uc804"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'    public void giveNotification(Long boardId, Long postId) {\n        List<UserBoard> userList = userBoardRepository.findByBoardIdAndIsExitedFalse(boardId);\n        Post post = postRepository.findById(postId)\n            .orElseThrow(() -> new ApplicationException("\uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 post", HttpStatus.NOT_FOUND));\n        String username = userRepository.findById(post.getUserId())\n            .orElseThrow(() -> new ApplicationException("\uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 user", HttpStatus.NOT_FOUND))\n            .getUsername();\n        for (UserBoard user : userList) {\n            notificationService.createNotification(user.getUserId(),\n                username + "\ub2d8\uc774 " + post.getTitle() + " \uac8c\uc2dc\uae00\uc744 \uc791\uc131 \ud558\uc168\uc2b5\ub2c8\ub2e4.");\n        }        \n    }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"berkinsert-\uc801\uc6a9-\ud6c4",children:"BerkInsert \uc801\uc6a9 \ud6c4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'    @Transactional\n    public void giveNotification(Long boardId, Long postId) {\n        PostWithUser postWithUser = postRepository.findPostWithUserById(postId)\n            .orElseThrow(() -> new ApplicationException("\uac8c\uc2dc\uae00 \uc5c6\uc74c", HttpStatus.NOT_FOUND));\n\n        String message = postWithUser.getUsername() + "\ub2d8\uc774 " + postWithUser.getPostTitle() + " \uac8c\uc2dc\uae00\uc744 \uc791\uc131\ud558\uc168\uc2b5\ub2c8\ub2e4.";\n\n        List<Long> userIds = userBoardRepository.findUserIdsByBoardIdAndIsExitedFalse(boardId);\n\n        List<Notification> notifications = userIds.stream()\n            .map(userId -> new Notification(userId, message))\n            .collect(Collectors.toList());\n\n        notificationRepository.bulkInsert(notifications);\n    }\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\ud574\uacb0\ub41c-\ud6c4-\ucffc\ub9ac-\uc2e4\ud589-\uacb0\uacfc",children:"\ud574\uacb0\ub41c \ud6c4 \ucffc\ub9ac \uc2e4\ud589 \uacb0\uacfc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Hibernate",children:"Hibernate: \n    select\n        user0_.id as id1_40,\n        user0_.email as email2_40,\n        user0_.password as password3_40,\n        user0_.username as username4_40 \n    from\n        user user0 \n    where\n        user0.id=?\nHibernate: \n    /* insert org.example.creww.post.entity.Post\n        / insert \n        into\n            post\n            (created_at, updated_at, board_id, content, title, user_id, views) \n        values\n            (?, ?, ?, ?, ?, ?, ?)\nHibernate: \n    / SELECT\n        new org.example.creww.post.dto.PostWithUser(p.id,\n        p.title,\n        u.id,\n        u.username) \n    FROM\n        Post p \n    JOIN\n        User u \n            ON p.userId = u.id \n    WHERE\n        p.id = :postId / select\n            post0_.id as col_00,\n            post0_.title as col_10,\n            user1_.id as col_20,\n            user1_.username as col_30 \n        from\n            post post0 \n        inner join\n            user user1 \n                on (\n                    post0_.userid=user1.id\n                ) \n        where\n            post0_.id=?\nHibernate: \n    / SELECT\n        ub.userId \n    FROM\n        UserBoard ub \n    WHERE\n        ub.boardId = :boardId \n        AND ub.isExited = false */ select\n            userboard0_.user_id as col_00 \n        from\n            userboard userboard0 \n        where\n            userboard0_.boardid=? \n            and userboard0.is_exited=0\n\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"JDBC \ud15c\ud50c\ub9bf\uc744 \uc0ac\uc6a9\ud574\uc11c \uc704\uc5d0\ub294 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc558\uc9c0\ub9cc \ub85c\uadf8\ub97c \ucc0d\uc5b4\uc11c \ucd94\uac00\ub97c \ud574\uc57c\uaca0\ub2e4"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},37592:e=>{e.exports=JSON.parse('{"permalink":"/docs/blog/dev/spring/berkinsert\ub97c-\uc0ac\uc6a9\ud55c-\ucffc\ub9ac-\uac1c\uc120","source":"@site/blog/dev/spring/berkinsert\ub97c-\uc0ac\uc6a9\ud55c-\ucffc\ub9ac-\uac1c\uc120.md","title":"BerkInsert\ub97c \uc0ac\uc6a9\ud55c \ucffc\ub9ac \uac1c\uc120","description":"\ubb38\uc81c\uac00 \ubc1c\uacac\ub41c \ucf54\ub4dc","date":"2024-10-16T00:00:00.000Z","tags":[{"inline":false,"label":"Dev","permalink":"/docs/blog/tags/dev","description":"\uac1c\ubc1c \uc2e4\uc804 \ub178\ud2b8"},{"inline":false,"label":"Java/SpringBoot","permalink":"/docs/blog/tags/dev/java-springboot","description":"Java/Spring Boot \uad00\ub828 \uae00"},{"inline":false,"label":"Database","permalink":"/docs/blog/tags/cs/database","description":"\ub370\uc774\ud130\ubca0\uc774\uc2a4"},{"inline":false,"label":"Java","permalink":"/docs/blog/tags/dev/java","description":"Java \uad00\ub828 \uae00"},{"inline":false,"label":"JPA","permalink":"/docs/blog/tags/dev/spring/jpa","description":"JPA/Hibernate"},{"inline":false,"label":"SQL","permalink":"/docs/blog/tags/cs/database/sql","description":"SQL"}],"readingTime":6.45,"hasTruncateMarker":false,"authors":[{"name":"thunder","title":"\uac1c\ubc1c\uc790","url":"https://github.com/pie0902","page":{"permalink":"/docs/blog/authors/thunder"},"socials":{"github":"https://github.com/pie0902"},"key":"thunder"}],"frontMatter":{"title":"BerkInsert\ub97c \uc0ac\uc6a9\ud55c \ucffc\ub9ac \uac1c\uc120","date":"2024-10-16T00:00:00.000Z","authors":["thunder"],"tags":["dev","java-springboot","database","java","jpa","sql"]},"unlisted":false,"prevItem":{"title":"\ud504\ub85c\uc138\uc2a4","permalink":"/docs/blog/cs/os/\ud504\ub85c\uc138\uc2a4"},"nextItem":{"title":"creww project \ucffc\ub9ac\uac1c\uc120","permalink":"/docs/blog/dev/spring/creww-project-\ucffc\ub9ac\uac1c\uc120"}}')}}]);